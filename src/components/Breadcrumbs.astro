---
import { Schema } from 'astro-seo-schema';

const { url } = Astro;

export interface Props {
  title: string;
}

const { title } = Astro.props;

// Determine breadcrumb structure based on URL path
const pathname = url.pathname;
const isCollectionsIndex = pathname === '/collections' || pathname === '/collections/';
const isCollectionDetail = pathname.startsWith('/collections/') && !isCollectionsIndex;

let breadcrumbItems: Array<{ name: string; href: string }> = [{ name: 'Home', href: '/' }];

if (isCollectionsIndex) {
  breadcrumbItems.push({ name: 'Collections', href: '/collections' });
} else if (isCollectionDetail) {
  breadcrumbItems.push({ name: 'Collections', href: '/collections' });
  breadcrumbItems.push({ name: title, href: pathname });
} else {
  breadcrumbItems.push({ name: title, href: pathname });
}

const breadcrumbSchema = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: breadcrumbItems.map((item, index) => ({
    '@type': 'ListItem',
    position: index + 1,
    name: item.name,
    item: new URL(item.href, Astro.site).toString()
  }))
};
---

<Schema item={breadcrumbSchema as any} />

<nav class="flex" aria-label="Breadcrumb">
  <ol role="list" class="flex items-center space-x-4 text-sm">
    {breadcrumbItems.map((item, index) => (
      <li>
        {index === 0 ? (
          <div>
            <a href={item.href} class="text-gray-400 hover:text-gray-500">
              {item.name}
            </a>
          </div>
        ) : (
          <div class="flex items-center">
            <svg
              class="h-4 w-4 shrink-0 text-gray-400"
              viewBox="0 0 20 20"
              fill="currentColor"
              aria-hidden="true"
            >
              <path
                fill-rule="evenodd"
                d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z"
                clip-rule="evenodd"
              />
            </svg>
            <a
              href={item.href}
              class="ml-4 line-clamp-1 font-medium text-gray-500 hover:text-gray-700"
              aria-current={index === breadcrumbItems.length - 1 ? 'page' : undefined}
            >
              {item.name}
            </a>
          </div>
        )}
      </li>
    ))}
  </ol>
</nav>
